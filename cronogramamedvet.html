<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cronograma Din√¢mico de Estudo Intensivo - Med Vet</title>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <style>
    :root {
      --main-blue: #2A5C82;
      --sec-blue: #5A8BAD;
      --medical-green: #4CAF50;
      --emergency-red: #D32F2F;
      --orange: #FF9800;
    }
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }
    body {
      margin: 0;
      padding: 20px;
      background: #f8f9fa;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .header {
      text-align: center;
      padding: 3rem 2rem;
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.05);
      margin-bottom: 2rem;
      background-image: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    }
    .btn {
      padding: 15px 40px;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      background-image: linear-gradient(135deg, var(--main-blue) 0%, var(--sec-blue) 100%);
      color: white;
      position: relative;
      overflow: hidden;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(42,92,130,0.3);
    }
    .days-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
    }
    .day-card {
      background: white;
      padding: 1.5rem;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      transition: transform 0.3s ease;
    }
    .day-card:hover {
      transform: translateY(-3px);
    }
    .subject-card {
      background: white;
      padding: 2rem;
      border-radius: 20px;
      margin: 2rem 0;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    .difficulty-slider {
      width: 100%;
      height: 10px;
      -webkit-appearance: none;
      border-radius: 5px;
      margin: 15px 0;
      background: #e9ecef;
    }
    .difficulty-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: white;
      border: 3px solid;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    .schedule-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      padding: 2rem;
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.05);
    }
    .day-column {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 15px;
    }
    .time-block {
      background: white;
      padding: 1rem;
      margin: 0.8rem 0;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: transform 0.3s ease;
    }
    .time-block:hover {
      transform: translateX(5px);
    }
    .time-display {
      background: var(--main-blue);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
    }
    .back-button {
      position: absolute;
      top: 20px;
      left: 20px;
      background: none;
      border: none;
      cursor: pointer;
      color: var(--main-blue);
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .number-input-wrapper {
      margin-top: 10px;
    }
    .hours-input {
      width: 100%;
      padding: 10px 15px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Tela Inicial -->
    <div class="header" id="initialScreen">
      <h1 style="color: var(--main-blue); margin-bottom: 1rem;">üìö Cronograma Din√¢mico de Estudo Intensivo - Med Vet</h1>
      <p style="font-size: 1.1rem; color: #666; margin-bottom: 2rem;">O cronograma que se adapta √† sua agenda do 1¬∫ per√≠odo de Med Vet</p>
      <button class="btn" onclick="startPlanning()">Vamos criar um cronograma ‚Üí</button>
    </div>

    <!-- Formul√°rio de Planejamento -->
    <div id="planningScreen" style="display: none;">
      <button class="back-button" onclick="goBack()">‚Üê Voltar</button>
      <div class="days-grid" id="daysContainer"></div>
      <div id="subjectsContainer"></div>
      <button class="btn" onclick="generateSchedule()" style="margin: 2rem auto; display: block;">‚ú® Gerar Cronograma</button>
    </div>

    <!-- Cronograma Gerado -->
    <div id="scheduleScreen" style="display: none;">
      <button class="back-button" onclick="showPlanningScreen()">‚Üê Voltar</button>
      <div id="scheduleOutput" class="schedule-grid"></div>
      <button class="btn" onclick="downloadSchedule()" style="margin: 2rem auto; display: block;">üì• Baixar Cronograma</button>
    </div>
  </div>

  <script>
    // Disciplinas adaptadas para Med Vet com os exatos nomes
    const subjects = {
      'PROCESSOS BIOQU√çMICOS E BIOF√çSICOS EM ANIMAIS': ['PROCESSOS BIOQU√çMICOS E BIOF√çSICOS EM ANIMAIS'],
      'ANATOMIA ESTRUTURAL ANIMAL': ['ANATOMIA ESTRUTURAL ANIMAL'],
      'CITOLOGIA E EMBRIOLOGIA VETERIN√ÅRIA': ['CITOLOGIA E EMBRIOLOGIA VETERIN√ÅRIA'],
      'BIOTERISMO E BEM-ESTAR ANIMAL': ['BIOTERISMO E BEM-ESTAR ANIMAL'],
      'ECOLOGIA, MANEJO E CONSERVA√á√ÉO DA VIDA SILVESTRE': ['ECOLOGIA, MANEJO E CONSERVA√á√ÉO DA VIDA SILVESTRE']
    };

    // Objeto para controlar disciplinas ignoradas
    const ignoredSubjects = {};

    const difficultyColors = ['#4CAF50', '#FFEB3B', '#FF9800', '#F44336', '#880808'];
    const difficultyLabels = ['F√°cil', 'Normal', 'M√©dio', 'Dif√≠cil', 'Muito Dif√≠cil'];

    let studyData = {
      days: {},
      subjects: {}
    };

    function startPlanning() {
      document.getElementById('initialScreen').style.display = 'none';
      document.getElementById('planningScreen').style.display = 'block';
      initializeDays();
      initializeSubjects();
    }

    function goBack() {
      document.getElementById('initialScreen').style.display = 'block';
      document.getElementById('planningScreen').style.display = 'none';
    }

    function showPlanningScreen() {
      document.getElementById('scheduleScreen').style.display = 'none';
      document.getElementById('planningScreen').style.display = 'block';
    }

    // Cria o input de disponibilidade de hor√°rio usando o controle nativo
    function createNumberInput(day) {
      const wrapper = document.createElement('div');
      wrapper.className = 'number-input-wrapper';
      
      const input = document.createElement('input');
      input.type = 'number';
      input.min = 0;
      input.max = 24;
      input.step = 0.5;
      input.className = 'hours-input';
      input.value = studyData.days[day] || 0;
      input.onchange = (e) => updateDayTime(day, e.target.value);
      
      wrapper.appendChild(input);
      return wrapper;
    }

    function initializeDays() {
      const days = ['Segunda-feira', 'Ter√ßa-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'S√°bado', 'Domingo'];
      const container = document.getElementById('daysContainer');
      container.innerHTML = '';
      
      days.forEach(day => {
        const card = document.createElement('div');
        card.className = 'day-card';
        card.innerHTML = `<h3 style="margin: 0 0 1rem 0;">üìÖ ${day}</h3>`;
        card.appendChild(createNumberInput(day));
        container.appendChild(card);
      });
    }

    function initializeSubjects() {
      const container = document.getElementById('subjectsContainer');
      container.innerHTML = '';
      
      for (const [subject, topics] of Object.entries(subjects)) {
        let html = `<div class="subject-card">
                      <h2 style="color: var(--main-blue); margin-top: 0;">${subject}</h2>
                      <label style="font-size: 0.9rem; color: #666;">
                        <input type="checkbox" id="include-${subject}" checked onchange="toggleSubject(this, '${subject}')"> Incluir disciplina
                      </label>`;
        
        topics.forEach(topic => {
          html += `
            <div class="topic" style="margin: 1.5rem 0;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <label style="font-weight: 500;">üìñ ${topic}</label>
                <span id="difficultyLabel-${subject}-${topic}" style="font-size: 0.9rem; color: #666;">M√©dio</span>
              </div>
              <input type="range" min="0" max="4" value="2" 
                     class="difficulty-slider"
                     oninput="updateDifficulty('${subject}', '${topic}', this.value)"
                     style="background: linear-gradient(to right, ${difficultyColors[2]} 100%, #e9ecef 100%)">
            </div>`;
        });
        
        html += `</div>`;
        container.innerHTML += html;
      }
    }

    function toggleSubject(checkbox, subject) {
      ignoredSubjects[subject] = !checkbox.checked;
    }

    function updateDayTime(day, hours) {
      hours = Math.min(parseFloat(hours) || 0, 24);
      studyData.days[day] = hours;
    }

    function updateDifficulty(subject, topic, value) {
      if(!studyData.subjects[subject]) studyData.subjects[subject] = {};
      studyData.subjects[subject][topic] = parseInt(value);
      
      const slider = event.target;
      const label = document.getElementById(`difficultyLabel-${subject}-${topic}`);
      slider.style.background = `linear-gradient(to right, ${difficultyColors[value]} 100%, #e9ecef 100%)`;
      label.textContent = difficultyLabels[value];
      label.style.color = difficultyColors[value];
    }

    function convertToTime(decimal) {
      const hours = Math.floor(decimal);
      const minutes = Math.round((decimal % 1) * 60);
      let result = '';
      if(hours > 0) result += `${hours} hora${hours !== 1 ? 's' : ''}`;
      if(minutes > 0) result += `${hours > 0 ? ' e ' : ''}${minutes} minuto${minutes !== 1 ? 's' : ''}`;
      return result || '0 minutos';
    }

    function generateSchedule() {
      const schedule = {};
      let totalWeight = 0;
      const weights = {};

      // Calcular pesos considerando somente disciplinas inclu√≠das
      for(const [subject, topics] of Object.entries(studyData.subjects)) {
        if(ignoredSubjects[subject]) continue;
        weights[subject] = {};
        for(const [topic, difficulty] of Object.entries(topics)) {
          if(difficulty === 0) continue;
          const weight = 5 - difficulty;
          weights[subject][topic] = weight;
          totalWeight += weight;
        }
      }

      if(totalWeight === 0) {
        alert('Por favor, defina a dificuldade para pelo menos um conte√∫do!');
        return;
      }

      // Distribuir horas
      Object.entries(studyData.days).forEach(([day, hours]) => {
        if(!hours) return;
        
        schedule[day] = [];
        let dayHours = hours;
        
        const weightedTopics = [];
        Object.entries(weights).forEach(([subject, topics]) => {
          Object.entries(topics).forEach(([topic, weight]) => {
            weightedTopics.push({
              subject,
              topic,
              weight: weight / totalWeight
            });
          });
        });

        weightedTopics.sort((a, b) => b.weight - a.weight);

        weightedTopics.forEach(({subject, topic, weight}) => {
          const time = hours * weight;
          if(time >= 0.25) {
            schedule[day].push({
              subject,
              topic,
              time: parseFloat(time.toFixed(2))
            });
            dayHours -= time;
          }
        });

        if(dayHours > 0) {
          schedule[day].push({
            subject: "Revis√£o",
            topic: "Tempo livre para revis√£o",
            time: parseFloat(dayHours.toFixed(2))
          });
        }
      });

      displaySchedule(schedule);
    }

    function displaySchedule(schedule) {
      const container = document.getElementById('scheduleOutput');
      container.innerHTML = '';
      
      Object.entries(schedule).forEach(([day, blocks]) => {
        const html = `
          <div class="day-column">
            <h3 style="color: var(--main-blue); margin: 0 0 1rem 0;">üìå ${day}</h3>
            ${blocks.map(block => `
              <div class="time-block">
                <div>
                  <strong>${block.topic}</strong><br>
                  <small style="color: #666;">${block.subject}</small>
                </div>
                <div class="time-display">
                  ${convertToTime(block.time)}
                </div>
              </div>
            `).join('')}
          </div>`;
        container.innerHTML += html;
      });
      
      document.getElementById('planningScreen').style.display = 'none';
      document.getElementById('scheduleScreen').style.display = 'block';
    }

    function downloadSchedule() {
      html2canvas(document.querySelector("#scheduleOutput")).then(canvas => {
        const link = document.createElement('a');
        link.download = 'cronograma-medvet.png';
        link.href = canvas.toDataURL();
        link.click();
      });
    }
  </script>
</body>
</html>
