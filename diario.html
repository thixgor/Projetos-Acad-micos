<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diário de Campo - Medicina</title>
	<meta property="og:title" content="Diário de Campo - IESC">
    <meta property="og:description" content="A ferramenta pra quem precisa criar um Diário de Campo, de forma rápida e já modelada.">
	<meta property="og:image" content="https://i.ibb.co/RG93kY6V/Inserir-um-pouquinho-de-texto-3.png">
	<meta property="og:image:width" content="1200">
	<meta property="og:image:height" content="630">
	<meta property="og:url" content="https://thiago.med.br">
    <meta property="og:type" content="website">
	<meta name="twitter:card" content="summary_large_image"> 
    <!-- Bootstrap CSS -->
	<script src="https://cdn.tiny.cloud/1/wnknc1eopnaayokad1axrsn0koq4pgrndxu8rhd7ozx5j9sg/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.3s ease;
        }
        /* Tema Claro (padrão) */
        body.light {
            background: linear-gradient(135deg, #f4f4f9, #e9ecef);
            color: #2c3e50;
        }
        /* Tema Escuro */
        body.dark {
            background: linear-gradient(135deg, #1a1a1a, #2c3e50);
            color: #e9ecef;
        }
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 30px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            border-radius: 15px;
            transition: transform 0.3s ease, background-color 0.3s ease, color 0.3s ease;
        }
        .container.light {
            background-color: #fff;
            color: #2c3e50;
        }
        .container.dark {
            background-color: #333;
            color: #e9ecef;
        }
        #home h1 {
            font-size: 2.5rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            font-weight: bold;
        }
		.light #home p {
			color: #666; /* Cor no tema claro */
		}
		.dark #home p {
			color: #e9ecef; /* Cor no tema escuro */
		}
		#home p {
			text-align: center;
			transition: color 0.3s ease; /* Adiciona transição para a cor */
		}
        #home button {
            background: linear-gradient(45deg, #28a745, #218838);
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
            transition: all 0.3s ease;
        }
        #home button:hover {
            background: linear-gradient(45deg, #218838, #1e7e34);
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(40, 167, 69, 0.4);
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }
		input, select {
			width: 100%;
			padding: 10px;
			margin-top: 5px;
			border: 1px solid #ccc;
			border-radius: 8px;
			box-sizing: border-box;
			font-size: 16px;
			transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
		}
        .dark input, .dark select, .dark textarea {
            background-color: #444;
            color: #e9ecef;
            border-color: #666;
        }
        #preview {
            margin-top: 10px;
            display: flex;
            flex-wrap: nowrap;
            gap: 10px;
            overflow-x: auto;
        }
        .preview-item {
            position: relative;
            width: 100px;
            height: 100px;
            flex: 0 0 auto;
        }
        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        .dark .preview-item img {
            border-color: #666;
        }
        .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: red;
            color: white;
            border: none;
            cursor: pointer;
            padding: 2px 5px;
            border-radius: 50%;
            font-size: 12px;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .remove-btn:hover {
            background: darkred;
        }
        .hidden {
            display: none !important;
        }
        #theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }
        @media (max-width: 600px) {
            .container {
                margin: 10px;
                padding: 15px;
            }
            #home h1 {
                font-size: 1.8rem;
            }
            #home button {
                font-size: 1rem;
                padding: 12px 20px;
            }
            .preview-item {
                width: 80px;
                height: 80px;
            }
            #theme-toggle {
                top: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body class="light">
    <!-- Botão de Troca de Tema -->
    <button id="theme-toggle">🌙</button>

    <!-- Página Inicial -->
	<div id="home" class="container light">
		<h1>Diário de Campo</h1>
		<p class="text-center mb-4">Crie seu relatório de vivências para o IESC!</p>
		<button class="btn btn-lg w-100" onclick="showCreatePage()">Criar Diário de Campo</button>
		<p class="text-center mt-4" style="font-size: 0.9rem;">Criado por Thiago F. Rodrigues</p>
	</div>

    <!-- Página de Criação do Diário -->
    <div id="create" class="container light hidden">
        <h1>Criar Diário de Campo</h1>
        <form id="diarioForm">
            <label for="nome">Nome do Aluno:</label>
            <input type="text" id="nome" required>

            <label for="matricula">Matrícula:</label>
            <input type="number" id="matricula" required>

            <label for="data">Data (DD/MM/AAAA):</label>
            <input type="date" id="data" required>

            <label for="local">Local de Prática:</label>
            <input type="text" id="local" required>

            <label for="professor">Professor:</label>
            <select id="professor" required>
                <option value="RONALD TEIXEIRA PECANHA FERNANDES">RONALD TEIXEIRA PECANHA FERNANDES</option>
            </select>

            <label for="relatorio">Relatório de Campo (máx. 12 linhas em Arial 12):</label>
            <textarea id="relatorio" name="relatorio" required></textarea>

            <label for="fotos">Anexar Fotos (máx. 6, atualmente <span id="imageCount">0</span>/6):</label>
            <input type="file" id="fotos" multiple accept="image/*" onchange="handleImageUpload(event)">
            <div id="preview"></div>

            <button type="button" class="btn btn-success mt-3" onclick="gerarPDF()">Finalizar</button>
        </form>
    </div>

    <!-- Bibliotecas Externas -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        let selectedImages = [];

        // Garantir que a página inicial está visível ao carregar
		tinymce.init({
			selector: '#relatorio',
			height: 300,
			menubar: false,
			plugins: 'lists',
			toolbar: 'undo redo | bold italic underline | bullist numlist | alignleft aligncenter alignright alignjustify',
			setup: function(editor) {
				editor.on('init', function() {
					if (document.body.classList.contains('dark')) {
						editor.getContainer().style.backgroundColor = '#444';
						editor.getContainer().style.color = '#e9ecef';
					}
				});
			}
		});
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('home').classList.remove('hidden');
            document.getElementById('create').classList.add('hidden');
            toggleTheme(); // Configura o tema inicial
        });

        function showCreatePage() {
            document.getElementById('home').classList.add('hidden');
            document.getElementById('create').classList.remove('hidden');
        }

        function handleImageUpload(event) {
            const files = Array.from(event.target.files);
            if (selectedImages.length + files.length > 6) {
                alert("Você pode selecionar no máximo 6 imagens.");
                event.target.value = ''; // Limpa a seleção
                return;
            }
            selectedImages = [...selectedImages, ...files];
            renderPreview();
        }

        function renderPreview() {
            const preview = document.getElementById('preview');
            preview.innerHTML = '';
            selectedImages.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    const item = document.createElement('div');
                    item.className = 'preview-item';
                    item.appendChild(img);
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'remove-btn';
                    removeBtn.textContent = 'X';
                    removeBtn.onclick = () => removeImage(index);
                    item.appendChild(removeBtn);
                    preview.appendChild(item);
                };
                reader.readAsDataURL(file);
            });
            updateImageCount();
        }

        function removeImage(index) {
            selectedImages.splice(index, 1);
            renderPreview();
        }

        function updateImageCount() {
            document.getElementById('imageCount').textContent = selectedImages.length;
        }

        // Função para alternar tema
		function toggleTheme() {
			const body = document.body;
			const containers = document.querySelectorAll('.container');
			const toggleButton = document.getElementById('theme-toggle');
			
			if (body.classList.contains('light')) {
				body.classList.remove('light');
				body.classList.add('dark');
				containers.forEach(container => {
					container.classList.remove('light');
					container.classList.add('dark');
				});
				toggleButton.textContent = '☀️';
				// Ajustar TinyMCE para tema escuro
				tinymce.activeEditor.getContainer().style.backgroundColor = '#444';
				tinymce.activeEditor.getContainer().style.color = '#e9ecef';
			} else {
				body.classList.remove('dark');
				body.classList.add('light');
				containers.forEach(container => {
					container.classList.remove('dark');
					container.classList.add('light');
				});
				toggleButton.textContent = '🌙';
				// Ajustar TinyMCE para tema claro
				tinymce.activeEditor.getContainer().style.backgroundColor = '#fff';
				tinymce.activeEditor.getContainer().style.color = '#000';
			}
		}

        // Evento do botão de tema
        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);

        async function gerarPDF() {
            // Capturar os valores dos campos
            const nome = document.getElementById('nome').value.trim();
            const matricula = document.getElementById('matricula').value.trim();
            const data = document.getElementById('data').value;
            const local = document.getElementById('local').value.trim();
            const professor = document.getElementById('professor').value;
            const relatorio = tinymce.get('relatorio').getContent({ format: 'text' });


            // Validação dos campos
            let erros = [];
            if (!nome) erros.push("Nome do Aluno");
            if (!matricula) erros.push("Matrícula");
            if (!data) erros.push("Data");
            if (!local) erros.push("Local de Prática");
            if (!professor) erros.push("Professor");
            if (!relatorio) erros.push("Relatório de Campo");

            if (erros.length > 0) {
                alert("Por favor, preencha todos os campos obrigatórios: " + erros.join(", "));
                return;
            }

            if (!window.jspdf || !window.jspdf.jsPDF) {
                alert("Erro: A biblioteca jsPDF não foi carregada corretamente. Verifique sua conexão com a internet.");
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Formatar data para DD/MM/AAAA
            const dataFormatada = new Date(data).toLocaleDateString('pt-BR');

            // Página 1
            doc.setFontSize(22);
            doc.setFont("helvetica", "bold");
            doc.text("DIÁRIO DE CAMPO", 105, 20, { align: "center" });
            doc.setFontSize(10);
            doc.setFont("helvetica", "normal");
            doc.setFont("helvetica", "italic");
            doc.text("A seguir uma apresentação do relato de vivências.", 105, 30, { align: "center" });
			doc.text(`Data: ${dataFormatada}`, 20, 30);
            doc.setFont("helvetica", "normal");
            doc.text("1. Informações institucionais;", 20, 40);
            doc.text("2. Identificação e detalhes.", 20, 45);
            doc.line(20, 50, 190, 50);

            // Seção Instituição com Logo
            doc.setFontSize(14);
            doc.setFont("helvetica", "bold");
            doc.text("INSTITUIÇÃO", 20, 60);
            // Adicionar a logo com proporção correta
            const logoUrl = "https://i.imgur.com/c5JnMVK.png";
            const logoWidth = 60; // Largura máxima em mm
            const logoHeight = logoWidth / 5.33; // Altura proporcional (proporção 2903:544 ≈ 5.33:1)
            try {
                doc.addImage(logoUrl, 'PNG', 20, 65, logoWidth, logoHeight);
            } catch (e) {
                console.error("Erro ao carregar a logo:", e);
                doc.text("(Logo não carregada)", 20, 70);
            }
            doc.setFontSize(10);
            doc.setFont("helvetica", "normal");
            const textY = 65 + logoHeight + 5; // Posição após a logo com margem
            doc.text("Universidade Unigranrio - Afya - Campus Barra da Tijuca", 20, textY);
            doc.text("Av. Ayrton Senna, 2.200 – Barra da Tijuca, Rio de Janeiro - RJ, 22775-003", 20, textY + 5);

            // Seção Identificação e Detalhes Melhorada
            doc.setFontSize(14);
            doc.setFont("helvetica", "bold");
            const idY = textY + 15; // Ajuste dinâmico baseado na logo
            doc.text("IDENTIFICAÇÃO & DETALHES", 20, idY);
            doc.setFontSize(12);
            doc.setFont("helvetica", "normal");
            
            // Lista com bolinhas
            const items = [
                `Nome: ${nome}`,
                `Matrícula: ${matricula}`,
                "Curso: Medicina",
                "Turno: Integral",
                "Semestre: 1° Semestre de 2025",
                "Disciplina: IESC (Integração Ensino-Serviço-Comunidade)",
                `Local de Prática: ${local}`,
                `Professor: ${professor}`
            ];
            
            let yPos = idY + 10;
            items.forEach(item => {
                doc.setFont("helvetica", "bold");
                doc.text("•", 20, yPos); // Bolinha
                doc.setFont("helvetica", "normal");
                doc.text(item, 25, yPos); // Texto após a bolinha
                yPos += 8; // Espaçamento entre linhas
            });
            
            doc.setFontSize(10);
            doc.text("Página 01 (um)", 105, 290, { align: "center" });

            // Página 2
            doc.addPage();
            doc.setFontSize(22);
            doc.setFont("helvetica", "bold");
            doc.text("DIÁRIO DE CAMPO", 105, 20, { align: "center" });
            doc.setFontSize(10);
            doc.setFont("helvetica", "normal");
            doc.text(`Data: ${dataFormatada}`, 20, 30);
            doc.setFont("helvetica", "italic");
            doc.text("A seguir uma apresentação do relato de vivências.", 105, 40, { align: "center" });
            doc.setFont("helvetica", "normal");
            doc.text("1. 1 (um) texto relatorial", 20, 50);
            doc.text("2. Fotografias da atividade.", 20, 55);
            doc.line(20, 60, 190, 60);

            doc.setFontSize(14);
            doc.setFont("helvetica", "bold");
            doc.text("TEXTO RELATORIAL (no máximo 12 linhas)", 105, 70, { align: "center" });
            doc.setFontSize(12);
            doc.setFont("helvetica", "normal");
            const relatorioLinhas = doc.splitTextToSize(relatorio, 170);
            doc.text(relatorioLinhas.slice(0, 12), 20, 80);
            doc.rect(20, 75, 170, 70);

            doc.setFontSize(14);
            doc.setFont("helvetica", "bold");
            doc.text("Fotografias produzidas durante a atividade:", 20, 155);
            let x = 20;
            const y = 165;
			if (selectedImages.length > 0) {
				try {
					for (let file of selectedImages.slice(0, 6)) {
						const imgData = await readFileAsDataURL(file);
						doc.addImage(imgData, 'JPEG', x, y, 30, 30);
						x += 35;
						if (x > 170) break;
					}
				} catch (e) {
					alert("Erro ao processar as imagens. Certifique-se de que as imagens são válidas.");
					console.error(e);
					return;
				}
			}

            doc.setFontSize(10);
            doc.text("Página 02 (dois)", 105, 290, { align: "center" });

            doc.save('diario_de_campo.pdf');
        }

        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
    </script>
</body>
</html>